"use strict";var V=Object.create;var C=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Y=Object.getPrototypeOf,Z=Object.prototype.hasOwnProperty;var T=(e,t)=>{for(var o in t)C(e,o,{get:t[o],enumerable:!0})},E=(e,t,o,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of X(t))!Z.call(e,r)&&r!==o&&C(e,r,{get:()=>t[r],enumerable:!(s=W(t,r))||s.enumerable});return e};var ee=(e,t,o)=>(o=e!=null?V(Y(e)):{},E(t||!e||!e.__esModule?C(o,"default",{value:e,enumerable:!0}):o,e)),te=e=>E(C({},"__esModule",{value:!0}),e);var me={};T(me,{StompSessionProvider:()=>O,mock:()=>y,useStompClient:()=>x,useSubscription:()=>k,withStompClient:()=>q,withSubscription:()=>$});module.exports=te(me);var d=require("react"),A=ee(require("sockjs-client/dist/sockjs.min.js"),1),F=require("@stomp/stompjs");var H=require("react"),M=new Map,oe=e=>{if(M.has(e))return M.get(e);let t=(0,H.createContext)(void 0);return M.set(e,t),t},u=oe;var N=require("react/jsx-runtime");function re(e){let{url:t,children:o,enabled:s,name:r,...n}=e,a=u(r||"default"),[p,S]=(0,d.useState)(void 0),b=(0,d.useRef)(new Map);(0,d.useEffect)(()=>{let c=new F.Client(n);return!n.brokerURL&&!n.webSocketFactory&&(c.webSocketFactory=function(){let i=new URL(t,window?.location?.href);if(i.protocol==="http:"||i.protocol==="https:")return new A.default(t);if(i.protocol==="ws:"||i.protocol==="wss:")return new WebSocket(t);throw new Error("Protocol not supported")}),c.onConnect=function(i){n.onConnect&&n.onConnect(i),b.current.forEach(f=>{f.subscription=c.subscribe(f.destination,f.callback,f.headers)}),S(c)},c.onWebSocketClose=function(i){n.onWebSocketClose&&n.onWebSocketClose(i),S(void 0)},n.onStompError||(c.onStompError=function(i){throw i}),s!==!1&&c.activate(),()=>{c.deactivate()}},[t,s,...Object.values(n)]);let Q=(c,i,f={})=>{let P=Math.random().toString(36).substr(2,9),I={destination:c,callback:i,headers:f};return b.current.set(P,I),p&&p.connected&&(I.subscription=p.subscribe(c,i,f)),()=>{let R=b.current.get(P);R.subscription&&R.subscription.unsubscribe(),b.current.delete(P)}};return(0,N.jsx)(a.Provider,{value:{client:p,subscribe:Q},children:o})}var O=re;var g=require("react");function se(e,t,o={},s){let r=(0,g.useContext)(u(s||"default"));if(r===void 0)throw new Error("There must be a StompSessionProvider as Ancestor of all Stomp Hooks and HOCs");let n=(0,g.useRef)(t),a=Array.isArray(e)?e:[e];n.current=t,(0,g.useEffect)(()=>{let p=[];return a.forEach(S=>p.push(r.subscribe(S,b=>{n.current(b)},o))),()=>{p.forEach(S=>{S()})}},[Object.values(a).toString(),Object.values(o).toString()])}var k=se;var U=require("react");function ne(e){let t=(0,U.useContext)(u(e||"default"));if(t===void 0)throw new Error("There must be a StompSessionProvider as Ancestor of all Stomp Hooks and HOCs");return t.client}var x=ne;var L=require("react/jsx-runtime");function ie(e,t){let o=s=>{let r=x(t);return(0,L.jsx)(e,{stompClient:r,...s})};return o.displayName=`withStompClient(${e.displayName||e.name})`,o}var q=ie;var _=require("react");var D=require("react/jsx-runtime");function ce(e,t,o={},s){let r=n=>{let a=(0,_.useRef)();return k(t,p=>{a.current&&a.current.onMessage(p)},o,s),(0,D.jsx)(e,{ref:a,...n})};return r.displayName=`withSubscription(${e.displayName||e.name})`,r}var $=ce;var y={};T(y,{StompSessionProviderMock:()=>w,getMockClient:()=>h,getMockSubscriptions:()=>z,getSentMockMessages:()=>B,mockClientPublish:()=>v,mockReceiveMessage:()=>j,reset:()=>K});var m=new Map;function J(e,t,o={}){let s=Math.random().toString(36).substr(2,9);return m.has(e)||m.set(e,new Map),m.get(e).set(s,t),()=>{m.get(e)?.delete(s)}}function j(e,t){m.has(e)&&m.get(e).forEach(o=>{o(t)})}function z(e){return e?m.get(e):m}var l=new Map;function v(e){l.has(e.destination)||l.set(e.destination,[]),l.get(e.destination).push(e)}function h(){return{publish:v}}function B(e){return e?l.get(e):l}var G=require("react/jsx-runtime");function w(e){let t=u(e.name||"default");return(0,G.jsx)(t.Provider,{value:{subscribe:J,client:e.client??h()},children:e.children})}function K(){m.clear(),l.clear()}0&&(module.exports={StompSessionProvider,mock,useStompClient,useSubscription,withStompClient,withSubscription});
//# sourceMappingURL=index.cjs.map